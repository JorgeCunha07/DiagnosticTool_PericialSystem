package org.dei;

import org.dei.facts.Resposta;
import org.dei.facts.model.Carro;
import org.dei.facts.Evidence;
import java.util.List;
import java.util.ArrayList;
import org.dei.facts.model.Componente;
import org.dei.whynot.WhyNot;

global org.dei.facts.model.Carro selectedCar;
global  org.dei.whynot.WhyNot whyNot;


function void generateWhyNotExplanation(WhyNot whyNot, Resposta resposta, String expectedConclusion) {
    List<String> explicacoes = resposta.getExplicacoesPorqueNao(); // Obtém a lista de explicações

    // Função que retorna uma explicação completa por que a conclusão não foi atingida
    String explanation = whyNot.getWhyNotExplanation(expectedConclusion);

    explicacoes.add("WhyNot explanation for " + expectedConclusion + ": " + explanation);

    resposta.setExplicacoesPorqueNao(explicacoes);  // Armazena todas as explicações na resposta
    System.out.println("WhyNot explanation for " + expectedConclusion + ": " + explanation);
}


// Helper functions
function Componente getComponenteByName(Carro carro, String nomeComponente) {
    for (Componente comp : carro.getComponentes()) {
        if (comp.getNome().equalsIgnoreCase(nomeComponente)) {
            return comp;
        }
    }
    return null;
}

function String getUnidadeComponente(Carro carro, String nomeComponente) {
    for (Componente comp : carro.getComponentes()) {
        if (comp.getNome().equalsIgnoreCase(nomeComponente)) {
            return comp.getUnidade();
        }
    }
    return "";
}

// Função auxiliar para substituir vírgula por ponto
function String substituirVirgulaPorPonto(String texto) {
    if (texto != null) {
        return texto.replace(",", ".");
    }
    return texto;
}

// Função auxiliar para verificar se a string é numérica
function boolean isNumeric(String str) {
    try {
        Double.parseDouble(str);
        return true;
    } catch (NumberFormatException e) {
        return false;
    }
}




// Rule D01: Start Diagnostic
rule "D01: Start Diagnostic"
    when
        $resposta : Resposta(estado == "iniciarDiagnostico")
    then
        System.out.println("O carro apresenta algum problema? (Sim/Não)");
        $resposta.setPergunta("O carro apresenta algum problema? (Sim/Não)");
        $resposta.setEstado("perguntarProblemaInicial");
        $resposta.setTexto(""); 
        $resposta.addPerguntaWhyNot("O carro apresenta algum problema? (Sim/Não)");
        $resposta.addRegraDisparada("D01: Start Diagnostic");
        update($resposta);
end

// Rule D02: Process response - Carro tem problema 'Sim'
rule "D02: Process response - Carro tem problema 'Sim'"
    when
        $resposta : Resposta(estado == "perguntarProblemaInicial", texto.equalsIgnoreCase("Sim"))
    then
        $resposta.setEstado("perguntarCarroLigaChave");
        Evidence<String, String> ev = new Evidence<>("problemaInicial", "Sim");
        $resposta.setTexto("");
        $resposta.addEvidencia(ev);
        $resposta.addRegraDisparada("D02: Process response - Carro tem problema 'Sim'");
        update($resposta);
end

// Regra D03: Carro sem problemas identificados
rule "D03: Process response - Carro tem problema 'Não'"
    when
        $resposta : Resposta(estado == "perguntarProblemaInicial", texto.equalsIgnoreCase("Não"))
    then
        $resposta.setDiagnostico("Sem problemas identificados");
        $resposta.setSolucao("Não é necessária nenhuma ação");
        $resposta.setPorque("O usuário indicou que o carro não apresenta problemas");
        $resposta.setPorqueNao("Nenhum problema foi relatado");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sem problemas identificados");
        $resposta.addRegraDisparada("D03: Process response - Carro tem problema 'Não'");
        update($resposta);
end

// Rule D04: Ask "O carro liga a chave?"
rule "D04: Ask 'O carro liga a chave?'"
    when
        $resposta : Resposta(estado == "perguntarCarroLigaChave")
    then
        String pergunta = "O carro liga a chave? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("processarCarroLigaChave");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D04: Ask 'O carro liga a chave?'");
        update($resposta);
end

// Rule D05: Process response to "O carro liga a chave?"
rule "D05: Process 'O carro liga a chave?'"
    when
        $resposta : Resposta(estado == "processarCarroLigaChave", texto != null && texto != "")
    then
        Evidence<String, String> ev = new Evidence<>("processarCarroLigaChave", $resposta.getTexto());
        $resposta.addEvidencia(new Evidence<>("processarCarroLigaChave", $resposta.getTexto()));
        if ($resposta.getTexto().equalsIgnoreCase("Sim")) {
            $resposta.setEstado("perguntarCarroLigaMasVaiAbaixo");
            $resposta.setTexto("");
        } else if ($resposta.getTexto().equalsIgnoreCase("Não")) {
            String pergunta = "O carro não liga a chave. Verifique a bateria e cabos de bateria.";
            System.out.println(pergunta);
            $resposta.setPergunta(pergunta);
            $resposta.setEstado("verificarBateriaECabos");
            $resposta.setTexto("");
            $resposta.addPerguntaWhyNot(pergunta);
        } else {
            String perguntaInvalida = "Resposta inválida.";
            System.out.println(perguntaInvalida);
            $resposta.setPergunta(perguntaInvalida);
            $resposta.setEstado("processarCarroLigaChave");
            $resposta.setTexto("");
        }
        $resposta.addRegraDisparada("D05: Process 'O carro liga a chave?'");
        update($resposta);
end
// Rule D06: Processar 'O carro liga a chave? Não'
rule "D06: Processar 'O carro liga a chave? Não'"
    when
        $resposta : Resposta(estado == "verificarBateriaECabos", texto == "")
    then
        String pergunta = "Verifique a bateria e cabos de bateria. A bateria está fraca ou sem carga? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarBateriaFraca");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D06: Processar 'O carro liga a chave? Não'");
        update($resposta);
end

// Rule D07: Verificar a bateria e cabos de bateria
rule "D07: Verificar a bateria e cabos de bateria"
    when
        $resposta : Resposta(estado == "verificarBateriaECabos", texto == "")
    then
        Evidence<String, String> ev = new Evidence<>("verificarBateriaECabos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        String pergunta = "Verifique a bateria e cabos de bateria. A bateria está fraca ou sem carga? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarBateriaFraca");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D07: Verificar a bateria e cabos de bateria");
        update($resposta);
end

// Rule D08: Processar 'Bateria fraca ou sem carga? Sim'
rule "D08: Processar 'Bateria fraca ou sem carga? Sim'"
    when
        $resposta : Resposta(estado == "perguntarBateriaFraca", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBateriaFraca", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Bateria com defeito ou sem carga");
        $resposta.setSolucao("Substituir ou recarregar a bateria");
        $resposta.setPorque("A bateria está fraca ou sem carga");
        $resposta.setPorqueNao("Outros componentes estão funcionando corretamente");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Bateria com defeito ou sem carga");
        $resposta.addRegraDisparada("D08: Processar 'Bateria fraca ou sem carga? Sim'");
        update($resposta);
end

// Rule D09: Processar 'Bateria fraca ou sem carga? Não'
rule "D09: Processar 'Bateria fraca ou sem carga? Não'"
    when
        $resposta : Resposta(estado == "perguntarBateriaFraca", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBateriaFraca", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarMotorArranque");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D09: Processar 'Bateria fraca ou sem carga? Não'");
        update($resposta);
end

// Rule D10: Verificar motor de arranque e pedal de embraiagem
rule "D10: Verificar motor de arranque e pedal de embraiagem"
    when
        $resposta : Resposta(estado == "verificarMotorArranque", texto == "")
    then
        String pergunta = "Verifique o motor de arranque e se o pedal de embraiagem está acionado. O motor de arranque está com defeito? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarMotorArranqueDefeito");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D10: Verificar motor de arranque e pedal de embraiagem");
        update($resposta);
end

// Rule D11: Processar 'Motor de arranque com defeito? Sim'
rule "D11: Processar 'Motor de arranque com defeito? Sim'"
    when
        $resposta : Resposta(estado == "perguntarMotorArranqueDefeito", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarMotorArranqueDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falha no motor de arranque");
        $resposta.setSolucao("Substituir motor de arranque");
        $resposta.setPorque("O motor de arranque está com defeito");
        $resposta.setPorqueNao("A bateria está funcionando corretamente");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falha no motor de arranque");
        $resposta.addRegraDisparada("D11: Processar 'Motor de arranque com defeito? Sim'");
        update($resposta);
end

// Rule D12: Processar 'Motor de arranque com defeito? Não'
rule "D12: Processar 'Motor de arranque com defeito? Não'"
    when
        $resposta : Resposta(estado == "perguntarMotorArranqueDefeito", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarMotorArranqueDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaIgnicao");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D12: Processar 'Motor de arranque com defeito? Não'");
        update($resposta);
end

// Rule D13: Verificar sistema de ignição
rule "D13: Verificar sistema de ignição"
    when
        $resposta : Resposta(estado == "verificarSistemaIgnicao", texto == "")
    then
        String pergunta = "Verifique o sistema de ignição. A ignição está a falhar? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarIgnicaoFalhando");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D13: Verificar sistema de ignição");
        update($resposta);
end

// Rule D14: Processar 'Ignição a falhar? Sim'
rule "D14: Processar 'Ignição a falhar? Sim'"
    when
        $resposta : Resposta(estado == "perguntarIgnicaoFalhando", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarIgnicaoFalhando", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sistema de ignição com defeito");
        $resposta.setSolucao("Verificar chave de ignição, fusíveis, conectores e alimentação de combustível");
        $resposta.setPorque("A ignição está a falhar");
        $resposta.setPorqueNao("Bateria e motor de arranque estão funcionando");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sistema de ignição com defeito");
        $resposta.addRegraDisparada("D14: Processar 'Ignição a falhar? Sim'");
        update($resposta);
end

// Rule D15: Processar 'Ignição a falhar? Não'
rule "D15: Processar 'Ignição a falhar? Não'"
    when
        $resposta : Resposta(estado == "perguntarIgnicaoFalhando", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarIgnicaoFalhando", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaSeguranca");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D15: Processar 'Ignição a falhar? Não'");
        update($resposta);
end

// Rule D16: Verificar sistema de segurança (Imobilizador)
rule "D16: Verificar sistema de segurança (Imobilizador)"
    when
        $resposta : Resposta(estado == "verificarSistemaSeguranca", texto == "")
    then
        String pergunta = "Verifique o sistema de segurança (Imobilizador). O imobilizador ou alarme está a bloquear? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarImobilizadorBloqueando");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D16: Verificar sistema de segurança (Imobilizador)");
        update($resposta);
end

// Rule D17: Processar 'Imobilizador ou alarme a bloquear? Sim'
rule "D17: Processar 'Imobilizador ou alarme a bloquear? Sim'"
    when
        $resposta : Resposta(estado == "perguntarImobilizadorBloqueando", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarImobilizadorBloqueando", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sistema de segurança ativado");
        $resposta.setSolucao("Desativar sistema de segurança");
        $resposta.setPorque("O imobilizador ou alarme está a bloquear o veículo");
        $resposta.setPorqueNao("Bateria, motor de arranque e ignição estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sistema de segurança ativado");
        $resposta.addRegraDisparada("D17: Processar 'Imobilizador ou alarme a bloquear? Sim'");
        update($resposta);
end

// Rule D18: Processar 'Imobilizador ou alarme a bloquear? Não'
rule "D18: Processar 'Imobilizador ou alarme a bloquear? Não'"
    when
        $resposta : Resposta(estado == "perguntarImobilizadorBloqueando", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarImobilizadorBloqueando", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarCaboCondutor");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D18: Processar 'Imobilizador ou alarme a bloquear? Não'");
        update($resposta);
end

// Rule D19: Verificar cabos condutores de energia elétrica
rule "D19: Verificar cabos condutores de energia elétrica"
    when
        $resposta : Resposta(estado == "verificarCaboCondutor", texto == "")
    then
        String pergunta = "Verifique cabos condutores de energia elétrica e fichas de ligação. Há fios danificados? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarFiosDanificados");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D19: Verificar cabos condutores de energia elétrica");
        update($resposta);
end

// Rule D20: Processar 'Fios danificados? Sim'
rule "D20: Processar 'Fios danificados? Sim'"
    when
        $resposta : Resposta(estado == "perguntarFiosDanificados", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFiosDanificados", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Fios com corte ou curto-circuito");
        $resposta.setSolucao("Reparar ou substituir cabos condutores de energia elétrica");
        $resposta.setPorque("Há fios danificados ou em curto-circuito");
        $resposta.setPorqueNao("Outros sistemas elétricos estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Fios com corte ou curto-circuito");
        $resposta.addRegraDisparada("D20: Processar 'Fios danificados? Sim'");
        update($resposta);
end

// Rule D21: Processar 'Fios danificados? Não'
rule "D21: Processar 'Fios danificados? Não'"
    when
        $resposta : Resposta(estado == "perguntarFiosDanificados", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFiosDanificados", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarTermostato");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D21: Processar 'Fios danificados? Não'");
        update($resposta);
end

// Rule D22: Perguntar 'O carro liga mas vai abaixo?'
rule "D22: Perguntar 'O carro liga mas vai abaixo?'"
    when
        $resposta : Resposta(estado == "perguntarCarroLigaMasVaiAbaixo", texto == "")
    then
        String pergunta = "O carro liga mas vai abaixo? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("processarCarroLigaMasVaiAbaixo");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D22: Perguntar 'O carro liga mas vai abaixo?'");
        update($resposta);
end

// Rule D23: Processar 'O carro liga mas vai abaixo? Sim'
rule "D23: Processar 'O carro liga mas vai abaixo? Sim'"
    when
        $resposta : Resposta(estado == "processarCarroLigaMasVaiAbaixo", texto.equalsIgnoreCase("Sim"))
    then
        Evidence<String, String> ev = new Evidence<>("processarCarroLigaMasVaiAbaixo", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSobreaquecimentoMotor");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D23: Processar 'O carro liga mas vai abaixo? Sim'");
        update($resposta);
end

// Rule D24: Processar 'O carro liga mas vai abaixo? Não'
rule "D24: Processar 'O carro liga mas vai abaixo? Não'"
    when
        $resposta : Resposta(estado == "processarCarroLigaMasVaiAbaixo", texto.equalsIgnoreCase("Não"))
    then
        Evidence<String, String> ev = new Evidence<>("processarCarroLigaMasVaiAbaixo", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("processarCarroFazBarulhoAnormal");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D24: Processar 'O carro liga mas vai abaixo? Não'");
        update($resposta);
end
// Rule D25: Verificar sobreaquecimento do motor
rule "D25: Verificar sobreaquecimento do motor"
    when
        $resposta : Resposta(estado == "verificarSobreaquecimentoMotor", texto == "")
    then
        String pergunta = "O motor está a sobreaquecer? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarMotorSobreaquecendo");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D25: Verificar sobreaquecimento do motor");
        update($resposta);
end

// Rule D26: Processar 'Motor a sobreaquecer? Sim'
rule "D26: Processar 'Motor a sobreaquecer? Sim'"
    when
        $resposta : Resposta(estado == "perguntarMotorSobreaquecendo", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarMotorSobreaquecendo", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaArrefecimento");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D26: Processar 'Motor a sobreaquecer? Sim'");
        update($resposta);
end

// Rule D27: Processar 'Motor a sobreaquecer? Não'
rule "D27: Processar 'Motor a sobreaquecer? Não'"
    when
        $resposta : Resposta(estado == "perguntarMotorSobreaquecendo", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarMotorSobreaquecendo", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaCombustivel");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D27: Processar 'Motor a sobreaquecer? Não'");
        update($resposta);
end

// Rule D28: Verificar sistema de arrefecimento
rule "D28: Verificar sistema de arrefecimento"
    when
        $resposta : Resposta(estado == "verificarSistemaArrefecimento", texto == "")
    then
        String pergunta = "Verifique o sistema de arrefecimento. O radiador ou ventoinha está com defeito? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarRadiadorVentoinhaDefeito");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D28: Verificar sistema de arrefecimento");
        update($resposta);
end

// Rule D29: Processar 'Radiador ou ventoinha com defeito? Sim'
rule "D29: Processar 'Radiador ou ventoinha com defeito? Sim'"
    when
        $resposta : Resposta(estado == "perguntarRadiadorVentoinhaDefeito", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarRadiadorVentoinhaDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Problema no radiador ou ventoinha");
        $resposta.setSolucao("Substituir radiador/ventoinha");
        $resposta.setPorque("O radiador ou a ventoinha estão com defeito");
        $resposta.setPorqueNao("Outros componentes do sistema de arrefecimento estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Problema no radiador ou ventoinha");
        $resposta.addRegraDisparada("D29: Processar 'Radiador ou ventoinha com defeito? Sim'");
        update($resposta);
end

// Rule D30: Processar 'Radiador ou ventoinha com defeito? Não'
rule "D30: Processar 'Radiador ou ventoinha com defeito? Não'"
    when
        $resposta : Resposta(estado == "perguntarRadiadorVentoinhaDefeito", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarRadiadorVentoinhaDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarFugasArrefecimento");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D30: Processar 'Radiador ou ventoinha com defeito? Não'");
        update($resposta);
end

// Rule D31: Verificar fugas no sistema de arrefecimento
rule "D31: Verificar fugas no sistema de arrefecimento"
    when
        $resposta : Resposta(estado == "verificarFugasArrefecimento", texto == "")
    then
        String pergunta = "Verifique se há fugas no sistema de arrefecimento. Fuga detectada? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarFugaArrefecimento");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D31: Verificar fugas no sistema de arrefecimento");
        update($resposta);
end

// Rule D32: Processar 'Fuga detectada? Sim'
rule "D32: Processar 'Fuga detectada? Sim'"
    when
        $resposta : Resposta(estado == "perguntarFugaArrefecimento", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFugaArrefecimento", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Fugas no sistema de arrefecimento");
        $resposta.setSolucao("Reparar fuga e completar fluido");
        $resposta.setPorque("Há uma fuga no sistema de arrefecimento");
        $resposta.setPorqueNao("Outros componentes do sistema de arrefecimento estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Fugas no sistema de arrefecimento");
        $resposta.addRegraDisparada("D32: Processar 'Fuga detectada? Sim'");
        update($resposta);
end

// Rule D33: Processar 'Fuga detectada? Não'
rule "D33: Processar 'Fuga detectada? Não'"
    when
        $resposta : Resposta(estado == "perguntarFugaArrefecimento", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFugaArrefecimento", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarTermostato");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D33: Processar 'Fuga detectada? Não'");
        update($resposta);
end

// Rule D34: Verificar termóstato
rule "D34: Verificar termóstato"
    when
        $resposta : Resposta(estado == "verificarTermostato", texto == "")
    then
        String pergunta = "Verifique o termóstato. O termóstato está defeituoso? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarTermostatoDefeituoso");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D34: Verificar termóstato");
        update($resposta);
end

// Rule D35: Processar 'Termóstato defeituoso? Sim'
rule "D35: Processar 'Termóstato defeituoso? Sim'"
    when
        $resposta : Resposta(estado == "perguntarTermostatoDefeituoso", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarTermostatoDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Termóstato com defeito");
        $resposta.setSolucao("Substituir termóstato");
        $resposta.setPorque("O termóstato está defeituoso");
        $resposta.setPorqueNao("Outros componentes do sistema de arrefecimento estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Termóstato com defeito");
        $resposta.addRegraDisparada("D35: Processar 'Termóstato defeituoso? Sim'");
        update($resposta);
end

// Rule D36: Processar 'Termóstato defeituoso? Não'
rule "D36: Processar 'Termóstato defeituoso? Não'"
    when
        $resposta : Resposta(estado == "perguntarTermostatoDefeituoso", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarTermostatoDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarBombaAgua");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D36: Processar 'Termóstato defeituoso? Não'");
        update($resposta);
end
// Rule D37: Verificar bomba de água
rule "D37: Verificar bomba de água"
    when
        $resposta : Resposta(estado == "verificarBombaAgua", texto == "")
    then
        String pergunta = "Verifique a bomba de água. A bomba de água está com defeito? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarBombaAguaDefeito");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D37: Verificar bomba de água");
        update($resposta);
end

// Regra D38: Processar 'Bomba de água com defeito? Sim'
rule "D38: Processar 'Bomba de água com defeito? Sim'"
    when
        $resposta : Resposta(estado == "perguntarBombaAguaDefeito", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBombaAguaDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falha na bomba de água");
        $resposta.setSolucao("Substituir bomba de água");
        $resposta.setPorque("A bomba de água está com defeito");
        $resposta.setPorqueNao("Outros componentes do sistema de arrefecimento estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falha na bomba de água");
        $resposta.addRegraDisparada("D38: Processar 'Bomba de água com defeito? Sim'");
        update($resposta);
end

// Rule D39: Processar 'Bomba de água com defeito? Não'
rule "D39: Processar 'Bomba de água com defeito? Não'"
    when
        $resposta : Resposta(estado == "perguntarBombaAguaDefeito", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBombaAguaDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Verificação adicional necessária");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Nenhum problema específico foi identificado no sistema de arrefecimento");
        $resposta.setPorqueNao("As verificações anteriores não apontaram falhas claras");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Verificação adicional necessária");
        $resposta.addRegraDisparada("D39: Processar 'Bomba de água com defeito? Não'");
        update($resposta);
end

// Rule D40: Verificar sistema de combustível
rule "D40: Verificar sistema de combustível"
    when
        $resposta : Resposta(estado == "verificarSistemaCombustivel", texto == "")
    then
        String pergunta = "Verifique o sistema de combustível. Há falta de combustível ou falha na bomba? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarFaltaCombustivelOuFalhaBomba");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D40: Verificar sistema de combustível");
        update($resposta);
end

// Regra D41: Processar 'Falta de combustível ou falha na bomba? Sim'
rule "D41: Processar 'Falta de combustível ou falha na bomba? Sim'"
    when
        $resposta : Resposta(estado == "perguntarFaltaCombustivelOuFalhaBomba", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFaltaCombustivelOuFalhaBomba", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falta de combustível ou bomba de combustível com defeito");
        $resposta.setSolucao("Reabastecer ou substituir a bomba de combustível");
        $resposta.setPorque("Há falta de combustível ou a bomba de combustível está com defeito");
        $resposta.setPorqueNao("Outros componentes do sistema de combustível estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falta de combustível ou bomba de combustível com defeito");
        $resposta.addRegraDisparada("D41: Processar 'Falta de combustível ou falha na bomba? Sim'");
        update($resposta);
end

// Rule D42: Processar 'Falta de combustível ou falha na bomba? Não'
rule "D42: Processar 'Falta de combustível ou falha na bomba? Não'"
    when
        $resposta : Resposta(estado == "perguntarFaltaCombustivelOuFalhaBomba", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFaltaCombustivelOuFalhaBomba", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarFiltroCombustivel");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D42: Processar 'Falta de combustível ou falha na bomba? Não'");
        update($resposta);
end

// Rule D43: Verificar filtro de combustível
rule "D43: Verificar filtro de combustível"
    when
        $resposta : Resposta(estado == "verificarFiltroCombustivel", texto == "")
    then
        String pergunta = "Verifique o filtro de combustível. O filtro de combustível está entupido? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarFiltroCombustivelEntupido");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D43: Verificar filtro de combustível");
        update($resposta);
end

// Regra D44: Processar 'Filtro de combustível entupido? Sim'
rule "D44: Processar 'Filtro de combustível entupido? Sim'"
    when
        $resposta : Resposta(estado == "perguntarFiltroCombustivelEntupido", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFiltroCombustivelEntupido", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Filtro de combustível entupido");
        $resposta.setSolucao("Substituir filtro de combustível");
        $resposta.setPorque("O filtro de combustível está entupido");
        $resposta.setPorqueNao("Outros componentes do sistema de combustível estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Filtro de combustível entupido");
        $resposta.addRegraDisparada("D44: Processar 'Filtro de combustível entupido? Sim'");
        update($resposta);
end

// Rule D45: Processar 'Filtro de combustível entupido? Não'
rule "D45: Processar 'Filtro de combustível entupido? Não'"
    when
        $resposta : Resposta(estado == "perguntarFiltroCombustivelEntupido", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFiltroCombustivelEntupido", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaInjecaoCombustivel");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D45: Processar 'Filtro de combustível entupido? Não'");
        update($resposta);
end

// Rule D46: Verificar sistema de injeção de combustível
rule "D46: Verificar sistema de injeção de combustível"
    when
        $resposta : Resposta(estado == "verificarSistemaInjecaoCombustivel", texto == "")
    then
        String pergunta = "Verifique o sistema de injeção de combustível. A injeção de combustível está com defeito? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarInjecaoCombustivelDefeito");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D46: Verificar sistema de injeção de combustível");
        update($resposta);
end

// Regra D47: Processar 'Injeção de combustível com defeito? Sim'
rule "D47: Processar 'Injeção de combustível com defeito? Sim'"
    when
        $resposta : Resposta(estado == "perguntarInjecaoCombustivelDefeito", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarInjecaoCombustivelDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Injeção de combustível com defeito");
        $resposta.setSolucao("Limpar ou substituir injetores");
        $resposta.setPorque("A injeção de combustível está com defeito");
        $resposta.setPorqueNao("Outros componentes do sistema de combustível estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Injeção de combustível com defeito");
        $resposta.addRegraDisparada("D47: Processar 'Injeção de combustível com defeito? Sim'");
        update($resposta);
end

// Rule D48: Processar 'Injeção de combustível com defeito? Não'
rule "D48: Processar 'Injeção de combustível com defeito? Não'"
    when
        $resposta : Resposta(estado == "perguntarInjecaoCombustivelDefeito", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarInjecaoCombustivelDefeito", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaIgnicaoNovamente");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D48: Processar 'Injeção de combustível com defeito? Não'");
        update($resposta);
end

// Rule D49: Verificar sistema de ignição (novamente)
rule "D49: Verificar sistema de ignição (novamente)"
    when
        $resposta : Resposta(estado == "verificarSistemaIgnicaoNovamente", texto == "")
    then
        String pergunta = "Verifique o sistema de ignição. As velas de ignição estão defeituosas? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarVelasIgnicaoDefeituosas");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D49: Verificar sistema de ignição (novamente)");
        update($resposta);
end

// Regra D50: Processar 'Velas de ignição defeituosas? Sim'
rule "D50: Processar 'Velas de ignição defeituosas? Sim'"
    when
        $resposta : Resposta(estado == "perguntarVelasIgnicaoDefeituosas", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarVelasIgnicaoDefeituosas", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falha nas velas de ignição");
        $resposta.setSolucao("Substituir velas de ignição");
        $resposta.setPorque("As velas de ignição estão defeituosas");
        $resposta.setPorqueNao("Outros componentes do sistema de ignição estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falha nas velas de ignição");
        $resposta.addRegraDisparada("D50: Processar 'Velas de ignição defeituosas? Sim'");
        update($resposta);
end

// Rule D51: Processar 'Velas de ignição defeituosas? Não'
rule "D51: Processar 'Velas de ignição defeituosas? Não'"
    when
        $resposta : Resposta(estado == "perguntarVelasIgnicaoDefeituosas", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarVelasIgnicaoDefeituosas", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSensoresMotor");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D51: Processar 'Velas de ignição defeituosas? Não'");
        update($resposta);
end

// Rule D52: Verificar sensores do motor
rule "D52: Verificar sensores do motor"
    when
        $resposta : Resposta(estado == "verificarSensoresMotor", texto == "")
    then
        String pergunta = "Verifique os sensores do motor (MAP, MAF, etc.). Há sensores defeituosos? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarSensoresDefeituosos");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D52: Verificar sensores do motor");
        update($resposta);
end

// Regra D53: Processar 'Sensores defeituosos? Sim'
rule "D53: Processar 'Sensores defeituosos? Sim'"
    when
        $resposta : Resposta(estado == "perguntarSensoresDefeituosos", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarSensoresDefeituosos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sensor do motor com falha");
        $resposta.setSolucao("Verificar e substituir sensores");
        $resposta.setPorque("Os sensores do motor estão defeituosos");
        $resposta.setPorqueNao("Outros componentes do motor estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sensor do motor com falha");
        $resposta.addRegraDisparada("D53: Processar 'Sensores defeituosos? Sim'");
        update($resposta);
end

// Rule D54: Processar 'Sensores defeituosos? Não'
rule "D54: Processar 'Sensores defeituosos? Não'"
    when
        $resposta : Resposta(estado == "perguntarSensoresDefeituosos", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarSensoresDefeituosos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Problema indeterminado");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Nenhum problema específico foi identificado");
        $resposta.setPorqueNao("As verificações anteriores não apontaram falhas claras");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Problema indeterminado");
        $resposta.addRegraDisparada("D54: Processar 'Sensores defeituosos? Não'");
        update($resposta);
end

// Rule D55: Perguntar 'O carro faz barulho anormal?'
rule "D55: Perguntar 'O carro faz barulho anormal?'"
    when
        $resposta : Resposta(estado == "processarCarroFazBarulhoAnormal", texto == "")
    then
        String pergunta = "O carro faz barulho anormal? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarCarroFazBarulhoAnormal");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D55: Perguntar 'O carro faz barulho anormal?'");
        update($resposta);
end

// Rule D56: Processar 'O carro faz barulho anormal? Sim'
rule "D56: Processar 'O carro faz barulho anormal? Sim'"
    when
        $resposta : Resposta(estado == "perguntarCarroFazBarulhoAnormal", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarCarroFazBarulhoAnormal", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarMotorBarulho");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D56: Processar 'O carro faz barulho anormal? Sim'");
        update($resposta);
end

// Rule D57: Processar 'O carro faz barulho anormal? Não'
rule "D57: Processar 'O carro faz barulho anormal? Não'"
    when
        $resposta : Resposta(estado == "perguntarCarroFazBarulhoAnormal", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarCarroFazBarulhoAnormal", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("processarCarroDificuldadeTravar");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D57: Processar 'O carro faz barulho anormal? Não'");
        update($resposta);
end

// Rule D58: Verificar motor (barulho)
rule "D58: Verificar motor (barulho)"
    when
        $resposta : Resposta(estado == "verificarMotorBarulho", texto == "")
    then
        String pergunta = "Verifique o motor. Há barulho no motor? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarBarulhoNoMotor");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D58: Verificar motor (barulho)");
        update($resposta);
end

// Rule D59: Processar 'Barulho no motor? Sim'
rule "D59: Processar 'Barulho no motor? Sim'"
    when
        $resposta : Resposta(estado == "perguntarBarulhoNoMotor", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBarulhoNoMotor", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarCorreiasCorrenteDentada");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D59: Processar 'Barulho no motor? Sim'");
        update($resposta);
end

// Rule D60: Processar 'Barulho no motor? Não'
rule "D60: Processar 'Barulho no motor? Não'"
    when
        $resposta : Resposta(estado == "perguntarBarulhoNoMotor", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarBarulhoNoMotor", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSuspensaoRodas");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D60: Processar 'Barulho no motor? Não'");
        update($resposta);
end

// Rule D61: Verificar correias ou corrente dentada
rule "D61: Verificar correias ou corrente dentada"
    when
        $resposta : Resposta(estado == "verificarCorreiasCorrenteDentada", texto == "")
    then
        String pergunta = "Verifique as correias ou corrente dentada. A correia dentada está gasta? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarCorreiaDentadaGasta");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D61: Verificar correias ou corrente dentada");
        update($resposta);
end

// Regra D62: Processar 'Correia dentada gasta? Sim'
rule "D62: Processar 'Correia dentada gasta? Sim'"
    when
        $resposta : Resposta(estado == "perguntarCorreiaDentadaGasta", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarCorreiaDentadaGasta", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Correia dentada gasta e rolamentos");
        $resposta.setSolucao("Substituir kit de distribuição");
        $resposta.setPorque("A correia dentada está gasta");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Correia dentada gasta e rolamentos");
        $resposta.addRegraDisparada("D62: Processar 'Correia dentada gasta? Sim'");
        update($resposta);
end

// Rule D63: Processar 'Correia dentada gasta? Não'
rule "D63: Processar 'Correia dentada gasta? Não'"
    when
        $resposta : Resposta(estado == "perguntarCorreiaDentadaGasta", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarCorreiaDentadaGasta", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarComponentesBarulhoMotor");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D63: Processar 'Correia dentada gasta? Não'");
        update($resposta);
end

// Rule D64: Verificar componentes (Bomba de água, alternador, etc.)
rule "D64: Verificar componentes (Bomba de água, alternador, etc.)"
    when
        $resposta : Resposta(estado == "verificarComponentesBarulhoMotor", texto == "")
    then
        Evidence<String, String> ev = new Evidence<>("verificarComponentesBarulhoMotor", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        String mensagem = "Verifique os seguintes componentes:\n1. Bomba de água\n2. Alternador\n3. Compressor de ar condicionado\n4. Tensores da correia\nDigite o número correspondente ao componente com defeito, ou 0 se nenhum:";
        System.out.println(mensagem);
        $resposta.setPergunta(mensagem);
        $resposta.setEstado("perguntarComponenteDefeituoso");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(mensagem);
        $resposta.addRegraDisparada("D64: Verificar componentes (Bomba de água, alternador, etc.)");
        update($resposta);
end

// Regra D65: Processar 'Componente defeituoso? 1'
rule "D65: Processar 'Componente defeituoso? 1'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso", texto == "1")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarComponenteDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falha na bomba de água");
        $resposta.setSolucao("Substituir bomba de água");
        $resposta.setPorque("A bomba de água está com defeito");
        $resposta.setPorqueNao("Outros componentes estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falha na bomba de água");
        $resposta.addRegraDisparada("D65: Processar 'Componente defeituoso? 1'");
        update($resposta);
end

// Regra D66: Processar 'Componente defeituoso? 2'
rule "D66: Processar 'Componente defeituoso? 2'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso", texto == "2")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarComponenteDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Alternador com defeito");
        $resposta.setSolucao("Substituir alternador");
        $resposta.setPorque("O alternador está com defeito");
        $resposta.setPorqueNao("Outros componentes estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Alternador com defeito");
        $resposta.addRegraDisparada("D66: Processar 'Componente defeituoso? 2'");
        update($resposta);
end

// Regra D67: Processar 'Componente defeituoso? 3'
rule "D67: Processar 'Componente defeituoso? 3'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso", texto == "3")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarComponenteDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Compressor de ar condicionado com defeito");
        $resposta.setSolucao("Substituir compressor de ar condicionado");
        $resposta.setPorque("O compressor de ar condicionado está com defeito");
        $resposta.setPorqueNao("Outros componentes estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Compressor de ar condicionado com defeito");
        $resposta.addRegraDisparada("D67: Processar 'Componente defeituoso? 3'");
        update($resposta);
end

// Rule D68: Processar 'Componente defeituoso? 4'
rule "D68: Processar 'Componente defeituoso? 4'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso", texto == "4")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarComponenteDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Falha nos tensores da correia");
        $resposta.setSolucao("Substituir tensores da correia");
        $resposta.setPorque("Os tensores da correia estão com defeito");
        $resposta.setPorqueNao("Outros componentes estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Falha nos tensores da correia");
        $resposta.addRegraDisparada("D68: Processar 'Componente defeituoso? 4'");
        update($resposta);
end

// Regra D69: Processar 'Componente defeituoso? 0'
rule "D69: Processar 'Componente defeituoso? 0'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso", texto == "0")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarComponenteDefeituoso", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarLubrificacaoMotor");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D69: Processar 'Componente defeituoso? 0'");
        update($resposta);
end

// Regra D70: Processar 'Componente defeituoso? Inválido'
rule "D70: Processar 'Componente defeituoso? Inválido'"
    when
        $resposta : Resposta(estado == "perguntarComponenteDefeituoso",
                             texto != "0" && texto != "1" && texto != "2" && texto != "3" && texto != "4" && texto != "")
    then
        System.out.println("Opção inválida. Por favor, digite um número de 0 a 4.");
        $resposta.setPergunta("Opção inválida. Por favor, digite um número de 0 a 4.");
        $resposta.setEstado("perguntarComponenteDefeituoso");
        $resposta.setTexto("");
        update($resposta);
end


// Rule D71: Verificar lubrificação do motor
rule "D71: Verificar lubrificação do motor"
    when
        $resposta : Resposta(estado == "verificarLubrificacaoMotor", texto == "")
    then
        Evidence<String, String> ev = new Evidence<>("verificarLubrificacaoMotor", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        String pergunta = "Verifique o nível de óleo do motor.";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("verificarNivelOleo");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D71: Verificar lubrificação do motor");
        update($resposta);
end

// Rule D72: Verificar nível de óleo
rule "D72: Verificar nível de óleo"
    when
        $resposta : Resposta(estado == "verificarNivelOleo", texto == "")
        $carro : Carro() from selectedCar
    then
        Componente oleoMotor = getComponenteByName($carro, "Óleo do Motor");
        String pergunta = "Qual é o nível atual de óleo? (Entre " + oleoMotor.getValorMinimo() + " e " + oleoMotor.getValorMaximo() + " " + oleoMotor.getUnidade() + ")";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarNivelOleoAtual");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D72: Verificar nível de óleo");
        update($resposta);
end

// Regra D73: Avaliar Nível de Óleo
rule "D73: Avaliar Nível de Óleo"
    when
        $resposta : Resposta(estado == "perguntarNivelOleoAtual", texto != "")
        $carro : Carro() from selectedCar
    then
        Componente oleoMotor = getComponenteByName($carro, "Óleo do Motor");
        String valorOleo = substituirVirgulaPorPonto($resposta.getTexto());
        System.out.println("Valor de óleo recebido: " + valorOleo);
        Evidence<String, String> ev = new Evidence<>("perguntarNivelOleoAtual", $resposta.getTexto());
        $resposta.addEvidencia(ev);

        if (isNumeric(valorOleo)) {
            double nivelOleo = Double.parseDouble(valorOleo);
            if (nivelOleo < oleoMotor.getValorMinimoIdeal()) {
                $resposta.setEstado("nivelOleoBaixo");
                $resposta.setTexto("");
            } else if (nivelOleo > oleoMotor.getValorMaximoIdeal()) {
                $resposta.setEstado("nivelOleoAlto");
                $resposta.setTexto("");
            } else {
                $resposta.setEstado("nivelOleoNormal");
                $resposta.setTexto("");
            }
        } else {
            String erro = "Valor inválido. Por favor, insira um valor numérico.";
            System.out.println(erro);
            $resposta.setPergunta(erro);
            $resposta.setEstado("perguntarNivelOleoAtual");
            $resposta.setTexto("");
        }
        $resposta.addRegraDisparada("D73: Avaliar Nível de Óleo");
        update($resposta);
end

// Regra D74: Nível de óleo baixo
rule "D74: Nível de óleo baixo"
    when
        $resposta : Resposta(estado == "nivelOleoBaixo")
    then
        Evidence<String, String> ev = new Evidence<>("nivelOleoBaixo", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Nível de óleo insuficiente");
        $resposta.setSolucao("Completar nível de óleo");
        $resposta.setPorque("O nível de óleo está abaixo do mínimo ideal");
        $resposta.setPorqueNao("O nível de óleo não está acima do máximo ideal");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Nível de óleo insuficiente");
        $resposta.addRegraDisparada("D74: Nível de óleo baixo");
        update($resposta);
end

// Regra D75: Nível de óleo alto
rule "D75: Nível de óleo alto"
    when
        $resposta : Resposta(estado == "nivelOleoAlto")
    then
        Evidence<String, String> ev = new Evidence<>("nivelOleoAlto", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Excesso de óleo");
        $resposta.setSolucao("Retirar excesso de óleo");
        $resposta.setPorque("O nível de óleo está acima do máximo ideal");
        $resposta.setPorqueNao("O nível de óleo não está abaixo do mínimo ideal");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Excesso de óleo");
        $resposta.addRegraDisparada("D75: Nível de óleo alto");
        update($resposta);
end

// Regra D76: Nível de óleo normal
rule "D76: Nível de óleo normal"
    when
        $resposta : Resposta(estado == "nivelOleoNormal")
    then
        Evidence<String, String> ev = new Evidence<>("nivelOleoNormal", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarSistemaEscape");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D76: Nível de óleo normal");
        update($resposta);
end

// Rule D77: Verificar sistema de escape
rule "D77: Verificar sistema de escape"
    when
        $resposta : Resposta(estado == "verificarSistemaEscape", texto == "")
    then
        String pergunta = "Verifique o sistema de escape. Há problema no sistema de escape? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarProblemaEscape");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D77: Verificar sistema de escape");
        update($resposta);
end

// Rule D78: Problema no sistema de escape - Sim
rule "D78: Problema no sistema de escape - Sim"
    when
        $resposta : Resposta(estado == "perguntarProblemaEscape", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarProblemaEscape", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Vazamento ou bloqueio no sistema de escape");
        $resposta.setSolucao("Reparar ou substituir sistema de escape");
        $resposta.setPorque("Há um problema identificado no sistema de escape");
        $resposta.setPorqueNao("Outros sistemas estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Vazamento ou bloqueio no sistema de escape");
        $resposta.addRegraDisparada("D78: Problema no sistema de escape - Sim");
        update($resposta);
end

// Rule D79: Problema no sistema de escape - Não
rule "D79: Problema no sistema de escape - Não"
    when
        $resposta : Resposta(estado == "perguntarProblemaEscape", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarProblemaEscape", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Verificação adicional necessária");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Nenhum problema específico foi identificado");
        $resposta.setPorqueNao("As verificações anteriores não apontaram falhas claras");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Verificação adicional necessária");
        $resposta.addRegraDisparada("D79: Problema no sistema de escape - Não");
        update($resposta);
end

// Rule D80: Verificar Suspensão e Rodas
rule "D80: Verificar Suspensão e Rodas"
    when
        $resposta : Resposta(estado == "verificarSuspensaoRodas", texto == "")
    then
        String pergunta = "Barulho na suspensão ou rodas? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarsuspensaoerodas");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D80: Verificar Suspensão e Rodas");
        update($resposta);
end

// Regra D81: Processar 'Barulho na suspensão ou rodas? Não'
rule "D81: Processar 'Barulho na suspensão ou rodas? Não'"
    when
        $resposta : Resposta(estado == "perguntarsuspensaoerodas", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarsuspensaoerodas", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sem barulho na suspensão ou rodas");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Não foi identificado o problema");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sem barulho na suspensão ou rodas");
        $resposta.addRegraDisparada("D81: Processar 'Barulho na suspensão ou rodas? Não'");
        update($resposta);
end

// Regra D82: Processar 'Barulho na suspensão ou rodas? Sim'
rule "D82: Processar 'Barulho na suspensão ou rodas? Sim'"
    when
        $resposta : Resposta(estado == "perguntarsuspensaoerodas", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarsuspensaoerodas", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarproblema_pneu_jantes_calcos");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D82: Processar 'Barulho na suspensão ou rodas? Sim'");
        update($resposta);
end

// Regra D83: Verificar Pneus, Jantes e Calços
rule "D83: Verificar Pneus, Jantes e Calços"
    when
        $resposta : Resposta(estado == "verificarproblema_pneu_jantes_calcos", texto == "")
    then
        String pergunta = "Verifique os pneus, jantes e calços. Há problema identificado? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarproblema_pneu_jantes_calcos");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D83: Verificar Pneus, Jantes e Calços");
        update($resposta);
end

// Regra D84: Processar 'Problema nos pneus, jantes ou calços? Sim'
rule "D84: Processar 'Problema nos pneus, jantes ou calços? Sim'"
    when
        $resposta : Resposta(estado == "perguntarproblema_pneu_jantes_calcos", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarproblema_pneu_jantes_calcos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Problema nos pneus, jantes ou calços");
        $resposta.setSolucao("Verificar e substituir pneus, jantes ou calços");
        $resposta.setPorque("Foi identificado um problema nos pneus, jantes ou calços");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Problema nos pneus, jantes ou calços");
        $resposta.addRegraDisparada("D84: Processar 'Problema nos pneus, jantes ou calços? Sim'");
        update($resposta);
end

// Regra D85: Processar 'Problema nos pneus, jantes ou calços? Não'
rule "D85: Processar 'Problema nos pneus, jantes ou calços? Não'"
    when
        $resposta : Resposta(estado == "perguntarproblema_pneu_jantes_calcos", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarproblema_pneu_jantes_calcos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setEstado("verificarAmortecedores");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D85: Processar 'Problema nos pneus, jantes ou calços? Não'");
        update($resposta);
end

// Regra D86: Verificar Amortecedores gastos ou bases de amortecedores gastos
rule "D86: Verificar Amortecedores gastos ou bases de amortecedores gastos"
    when
        $resposta : Resposta(estado == "verificarAmortecedores", texto == "")
    then
        String pergunta = "Verifique os amortecedores e as bases dos amortecedores. Há problema identificado? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarproblema_amortecedores");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D86: Verificar Amortecedores gastos ou bases de amortecedores gastos");
        update($resposta);
end

// Regra D87: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Sim'
rule "D87: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Sim'"
    when
        $resposta : Resposta(estado == "perguntarproblema_amortecedores", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarproblema_amortecedores", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Amortecedores gastos ou bases de amortecedores gastos");
        $resposta.setSolucao("Verificar e substituir amortecedores ou bases de amortecedores");
        $resposta.setPorque("Foi identificado um problema nos amortecedores ou bases de amortecedores");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Amortecedores gastos ou bases de amortecedores gastos");
        $resposta.addRegraDisparada("D87: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Sim'");
        update($resposta);
end

// Regra D88: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Não'
rule "D88: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Não'"
    when
        $resposta : Resposta(estado == "perguntarproblema_amortecedores", texto == "Não")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarproblema_amortecedores", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sem Amortecedores gastos ou bases de amortecedores gastos");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Não foi identificado o problema");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sem Amortecedores gastos ou bases de amortecedores gastos");
        $resposta.addRegraDisparada("D88: Processar 'Amortecedores gastos ou bases de amortecedores gastos? Não'");
        update($resposta);
end

// Regra D89: Verificar Carro Dificuldade Travar
rule "D89: Verificar Carro Dificuldade Travar"
    when
        $resposta : Resposta(estado == "processarCarroDificuldadeTravar", texto == "")
    then
        String pergunta = "O carro tem dificuldade em travar? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarCarroDificuldadeTravar");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D89: Verificar Carro Dificuldade Travar");
        update($resposta);
end

// Regra D90: Verificar sistema de travões
rule "D90: Verificar sistema de travões"
    when
        $resposta : Resposta(estado == "verificarSistemaTravoes", texto == "")
    then
        String pergunta = "Pastilhas de travão gastas? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarPastilhasTravaoGastas");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D90: Verificar sistema de travões");
        update($resposta);
end

// Regra D91: Processar 'Pastilhas de travão gastas? Sim'
rule "D91: Processar 'Pastilhas de travão gastas? Sim'"
    when
        $resposta : Resposta(estado == "perguntarPastilhasTravaoGastas", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarPastilhasTravaoGastas", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Pastilhas de travão gastas");
        $resposta.setSolucao("Substituir pastilhas de travão");
        $resposta.setPorque("Pastilhas de travão gastas");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Pastilhas de travão gastas");
        $resposta.addRegraDisparada("D91: Processar 'Pastilhas de travão gastas? Sim'");
        update($resposta);
end

// Regra D92: Processar 'Pastilhas de travão gastas? Não'
rule "D92: Processar 'Pastilhas de travão gastas? Não'"
    when
        $resposta : Resposta(estado == "perguntarPastilhasTravaoGastas", texto == "Não")
    then
        String pergunta = "Discos de travão gastos? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarDiscosTravaoGastos");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D92: Processar 'Pastilhas de travão gastas? Não'");
        update($resposta);
end

rule "D93: Processar 'Discos de travão gastos? Sim'"
    when
        $resposta : Resposta(estado == "perguntarDiscosTravaoGastos", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarDiscosTravaoGastos", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Discos de travão gastos");
        $resposta.setSolucao("Substituir discos de travão");
        $resposta.setPorque("Discos de travão gastos");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Discos de travão gastos");
        $resposta.addRegraDisparada("D93: Processar 'Discos de travão gastos? Sim'");
        update($resposta);
end

// Regra D94: Processar 'Discos de travão gastos? Não'
rule "D94: Processar 'Discos de travão gastos? Não'"
    when
        $resposta : Resposta(estado == "perguntarDiscosTravaoGastos", texto == "Não")
    then
        String pergunta = "Nível de fluido de travão? (Baixo/Alto/Normal)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarNivelFluidoTravao");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D94: Processar 'Discos de travão gastos? Não'");
        update($resposta);
end

// Regra D95: Processar 'Nível de fluido de travão baixo'
rule "D95: Processar 'Nível de fluido de travão baixo'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoTravao", texto == "Baixo")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarNivelFluidoTravao", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Nível de fluido insuficiente");
        $resposta.setSolucao("Completar fluido de travão e corrigir possíveis fugas");
        $resposta.setPorque("Nível de fluido insuficiente");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Nível de fluido insuficiente");
        $resposta.addRegraDisparada("D95: Processar 'Nível de fluido de travão baixo'");
        update($resposta);
end

// Regra D96: Processar 'Nível de fluido de travão alto'
rule "D96: Processar 'Nível de fluido de travão alto'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoTravao", texto == "Alto")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarNivelFluidoTravao", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Excesso de fluido de travão");
        $resposta.setSolucao("Ajustar nível de fluido de travão");
        $resposta.setPorque("Nível de fluido excessivo");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Excesso de fluido de travão");
        $resposta.addRegraDisparada("D96: Processar 'Nível de fluido de travão alto'");
        update($resposta);
end

// Regra D97: Processar 'Nível de fluido de travão normal'
rule "D97: Processar 'Nível de fluido de travão normal'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoTravao", texto == "Normal")
    then
        String pergunta = "Problema no servofreio? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarProblemaServoFreio");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D97: Processar 'Nível de fluido de travão normal'");
        update($resposta);
end

// Regra D98: Processar 'Problema no servofreio? Sim'
rule "D98: Processar 'Problema no servofreio? Sim'"
    when
        $resposta : Resposta(estado == "perguntarProblemaServoFreio", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarProblemaServoFreio", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Servo freio defeituoso");
        $resposta.setSolucao("Reparar ou substituir servofreio");
        $resposta.setPorque("Servo freio defeituoso");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Servo freio defeituoso");
        $resposta.addRegraDisparada("D98: Processar 'Problema no servofreio? Sim'");
        update($resposta);
end

// Regra D99: Processar 'Problema no servofreio? Não'
rule "D99: Processar 'Problema no servofreio? Não'"
    when
        $resposta : Resposta(estado == "perguntarProblemaServoFreio", texto == "Não")
    then
        String pergunta = "ABS com falha? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarFalhaABS");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D99: Processar 'Problema no servofreio? Não'");
        update($resposta);
end

// Regra D100: Processar 'ABS com falha? Sim'
rule "D100: Processar 'ABS com falha? Sim'"
    when
        $resposta : Resposta(estado == "perguntarFalhaABS", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarFalhaABS", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Sistema ABS com defeito");
        $resposta.setSolucao("Verificar e reparar sistema ABS com consulta de especialista");
        $resposta.setPorque("Sistema ABS com defeito");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Sistema ABS com defeito");
        $resposta.addRegraDisparada("D100: Processar 'ABS com falha? Sim'");
        update($resposta);
end

// Regra D101: Processar 'ABS com falha? Não'
rule "D101: Processar 'ABS com falha? Não'"
    when
        $resposta : Resposta(estado == "perguntarFalhaABS", texto == "Não")
    then
        $resposta.setDiagnostico("Problema indeterminado");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Problema indeterminado");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Problema indeterminado");
        $resposta.addRegraDisparada("D101: Processar 'ABS com falha? Não'");
        update($resposta);
end

// Regra D102: Processar 'Verificar Carro Dificuldade Travar? Não'
rule "D102: Processar 'Verificar Carro Dificuldade Travar? Não'"
    when
        $resposta : Resposta(estado == "perguntarCarroDificuldadeTravar", texto == "Não")
    then
        $resposta.setEstado("verificarcaixadevelocidades");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D102: Processar 'Verificar Carro Dificuldade Travar? Não'");
        update($resposta);
end

// Regra D103: Processar 'Verificar Carro Dificuldade Travar? Sim'
rule "D103: Processar 'Verificar Carro Dificuldade Travar? Sim'"
    when
        $resposta : Resposta(estado == "perguntarCarroDificuldadeTravar", texto == "Sim")
    then
        $resposta.setEstado("verificarSistemaTravoes");
        $resposta.setTexto("");
        $resposta.addRegraDisparada("D103: Processar 'Verificar Carro Dificuldade Travar? Sim'");
        update($resposta);
end

// Regra D104: Verificar problemas na caixa de velocidades
rule "D104: Verificar problemas na caixa de velocidades"
    when
        $resposta : Resposta(estado == "verificarcaixadevelocidades", texto == "")
    then
        System.out.println("Verificar problemas na caixa de velocidades.");
        $resposta.setPergunta("Verificar problemas na caixa de velocidades.");
        $resposta.setEstado("perguntarcaixadevelocidades");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot("Verificar problemas na caixa de velocidades.");
        $resposta.addRegraDisparada("D104: Verificar problemas na caixa de velocidades");
        update($resposta);
end

// Regra D105: Processar 'Verificar problemas na caixa de velocidades? Não'
rule "D105: Processar 'Verificar problemas na caixa de velocidades? Não'"
    when
        $resposta : Resposta(estado == "perguntarcaixadevelocidades", texto == "Não")
    then
        $resposta.setDiagnostico("Nenhum problema identificado");
        $resposta.setSolucao("Nenhuma ação necessária");
        $resposta.setPorque("Nenhum problema foi identificado na caixa de velocidades");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Nenhum problema identificado");
        $resposta.addRegraDisparada("D105: Processar 'Verificar problemas na caixa de velocidades? Não'");
        update($resposta);
end

// Regra D106: Processar 'Verificar problemas na caixa de velocidades? Sim'
rule "D106: Processar 'Verificar problemas na caixa de velocidades? Sim'"
    when
        $resposta : Resposta(estado == "perguntarcaixadevelocidades", texto == "Sim")
    then
        String pergunta = "Nível de fluido < Mínimo, > Máximo ou Normal? (Minimo/Maximo/Normal)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarNivelFluidoCaixa");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D106: Processar 'Verificar problemas na caixa de velocidades? Sim'");
        update($resposta);
end

// Regra D107: Processar 'Nível de fluido de caixa de velocidades < Mínimo'
rule "D107: Processar 'Nível de fluido de caixa de velocidades < Mínimo'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoCaixa", texto == "Minimo")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarNivelFluidoCaixa", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Nível de fluido de transmissão baixo");
        $resposta.setSolucao("Completar fluido de transmissão e verificar possíveis fugas");
        $resposta.setPorque("Nível de fluido de transmissão está abaixo do mínimo");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Nível de fluido de transmissão baixo");
        $resposta.addRegraDisparada("D107: Processar 'Nível de fluido de caixa de velocidades < Mínimo'");
        update($resposta);
end

// Regra D108: Processar 'Nível de fluido de caixa de velocidades > Máximo'
rule "D108: Processar 'Nível de fluido de caixa de velocidades > Máximo'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoCaixa", texto == "Maximo")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarNivelFluidoCaixa", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Excesso de fluido de transmissão");
        $resposta.setSolucao("Ajustar fluido de transmissão");
        $resposta.setPorque("Nível de fluido de transmissão está acima do máximo");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Excesso de fluido de transmissão");
        $resposta.addRegraDisparada("D108: Processar 'Nível de fluido de caixa de velocidades > Máximo'");
        update($resposta);
end

// Regra D109: Processar 'Nível de fluido de caixa de velocidades Normal'
rule "D109: Processar 'Nível de fluido de caixa de velocidades Normal'"
    when
        $resposta : Resposta(estado == "perguntarNivelFluidoCaixa", texto == "Normal")
    then
        String pergunta = "Embraiagem gasta ou a patinar? (Sim/Não)";
        System.out.println(pergunta);
        $resposta.setPergunta(pergunta);
        $resposta.setEstado("perguntarEmbraiagem");
        $resposta.setTexto("");
        $resposta.addPerguntaWhyNot(pergunta);
        $resposta.addRegraDisparada("D109: Processar 'Nível de fluido de caixa de velocidades Normal'");
        update($resposta);
end

// Regra D110: Processar 'Embraiagem gasta ou a patinar? Sim'
rule "D110: Processar 'Embraiagem gasta ou a patinar? Sim'"
    when
        $resposta : Resposta(estado == "perguntarEmbraiagem", texto == "Sim")
    then
        Evidence<String, String> ev = new Evidence<>("perguntarEmbraiagem", $resposta.getTexto());
        $resposta.addEvidencia(ev);
        $resposta.setDiagnostico("Embraiagem com desgaste excessivo ou volante bimassa defeituoso");
        $resposta.setSolucao("Substituir kit de embraiagem");
        $resposta.setPorque("Embraiagem gasta ou a patinar");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Embraiagem com desgaste excessivo ou volante bimassa defeituoso");
        $resposta.addRegraDisparada("D110: Processar 'Embraiagem gasta ou a patinar? Sim'");
        update($resposta);
end

// Regra D111: Processar 'Embraiagem gasta ou a patinar? Não'
rule "D111: Processar 'Embraiagem gasta ou a patinar? Não'"
    when
        $resposta : Resposta(estado == "perguntarEmbraiagem", texto == "Não")
    then
        $resposta.setDiagnostico("Verificação adicional necessária");
        $resposta.setSolucao("Consultar especialista");
        $resposta.setPorque("Embraiagem não está gasta ou a patinar");
        $resposta.setPorqueNao("Outros componentes relacionados estão funcionais");
        $resposta.setEstado("diagnosticoConcluido");
        generateWhyNotExplanation(whyNot, $resposta, "Verificação adicional necessária");
        $resposta.addRegraDisparada("D111: Processar 'Embraiagem gasta ou a patinar? Não'");
        update($resposta);
end



// Rule DX: Diagnóstico Concluído
rule "DX: Diagnóstico Concluído"
    when
        $resposta : Resposta(estado == "diagnosticoConcluido")
    then
        System.out.println("Diagnóstico: " + $resposta.getDiagnostico());
        System.out.println("Solução: " + $resposta.getSolucao());
        System.out.println("Porquê: " + $resposta.getPorque());
        System.out.println("Por que não: ");
        String expectedConclusion = $resposta.getDiagnostico();
        String explanation = whyNot.getWhyNotExplanation(expectedConclusion);
        System.out.println(explanation);
        $resposta.setEstado("finalizado");
        update($resposta);
end
